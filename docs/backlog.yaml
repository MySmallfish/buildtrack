epics:
  - key: "A"
    title: "Authentication & RBAC"
    priority: "P0"
    stories:
      - id: "A1"
        title: "Login as a user"
        as: "User"
        want: "to log in with email/password"
        so: "I can access my workspace"
        priority: "P0"
        acceptance:
          - "Valid credentials yield JWT access and refresh tokens"
          - "Invalid credentials return 401"
          - "Session persists via refresh token rotation"
        tasks:
          - id: "A1-T1"
            title: "Integrate ASP.NET Identity with password hashing and tenant scoping"
            status: "done"
            est: "6h"
          - id: "A1-T2"
            title: "Implement /auth/login, /auth/refresh, /auth/logout, and /me endpoints"
            status: "done"
            est: "6h"
          - id: "A1-T3"
            title: "Seed Admin and Project Manager users for default workspace"
            status: "done"
            est: "2h"
          - id: "A1-T4"
            title: "Implement appMachine authentication flow with session bootstrap"
            status: "done"
            est: "4h"
          - id: "A1-T5"
            title: "Build login form UI with error handling and password reset affordance"
            status: "done"
            est: "4h"
          - id: "A1-T6"
            title: "Store tokens securely (in-memory access, httpOnly refresh cookie) and handle refresh"
            status: "done"
            est: "4h"
          - id: "A1-T7"
            title: "QA scenarios: happy path, invalid credentials, refresh token rotation"
            status: "todo"
            est: "3h"
      - id: "A2"
        title: "Role enforcement"
        as: "Admin or Project Manager"
        want: "role-based permissions enforced"
        so: "users only perform allowed actions"
        priority: "P0"
        acceptance:
          - "Admin, PM, Contributor capabilities enforced server-side"
          - "Forbidden actions return 403"
        tasks:
          - id: "A2-T1"
            title: "Add authorization policies per role and workspace-aware handlers"
            status: "done"
            est: "5h"
          - id: "A2-T2"
            title: "Apply global workspace query filters in EF Core"
            status: "done"
            est: "4h"
          - id: "A2-T3"
            title: "Hide or disable forbidden UI actions based on role context"
            status: "done"
            est: "3h"
          - id: "A2-T4"
            title: "Integration tests for RBAC matrix and IDOR attempts"
            status: "todo"
            est: "5h"

  - key: "B"
    title: "Entities Management"
    priority: "P0"
    stories:
      - id: "B1"
        title: "Manage Skills"
        as: "Admin"
        want: "to create and manage skills"
        so: "skills appear in contributor pickers"
        priority: "P0"
        acceptance:
          - "Admin can create, edit, disable skills"
          - "PM can assign skills to users"
          - "Disabled skills excluded from pickers"
        tasks:
          - id: "B1-T1"
            title: "Create Skill entity, EF configuration, and CRUD endpoints"
            status: "done"
            est: "6h"
          - id: "B1-T2"
            title: "Build admin UI for listing, creating, and disabling skills"
            status: "todo"
            est: "5h"
          - id: "B1-T3"
            title: "Integrate skill assignment controls into user management"
            status: "todo"
            est: "4h"
          - id: "B1-T4"
            title: "QA uniqueness, disable behavior, and UX"
            status: "todo"
            est: "3h"
      - id: "B2"
        title: "Milestone & Document Types"
        as: "Admin"
        want: "to define milestone and document type defaults"
        so: "templates preconfigure requirements"
        priority: "P0"
        acceptance:
          - "Milestone and document types capture required metadata"
          - "File type rules enforced during upload"
        tasks:
          - id: "B2-T1"
            title: "Implement MilestoneType and DocumentType entities with validation"
            status: "done"
            est: "6h"
          - id: "B2-T2"
            title: "Seed starter milestone and document types"
            status: "done"
            est: "2h"
          - id: "B2-T3"
            title: "Admin UI for managing milestone/document types with extension chips"
            status: "todo"
            est: "5h"
          - id: "B2-T4"
            title: "Server-side validation and unit tests for file type enforcement"
            status: "todo"
            est: "4h"
      - id: "B3"
        title: "Project Type templates"
        as: "Project Manager"
        want: "to define ordered milestone templates"
        so: "projects can be created quickly"
        priority: "P0"
        acceptance:
          - "Template stores milestones with due offsets and requirements"
          - "Creating from template prepopulates project correctly"
        tasks:
          - id: "B3-T1"
            title: "Persist Template aggregate with milestone and requirement definitions"
            status: "done"
            est: "7h"
          - id: "B3-T2"
            title: "API to create, version, and retrieve templates"
            status: "done"
            est: "5h"
          - id: "B3-T3"
            title: "Frontend template editor with reorder and requirement editing"
            status: "todo"
            est: "8h"
          - id: "B3-T4"
            title: "End-to-end test ensuring project creation honors template"
            status: "todo"
            est: "4h"

  - key: "C"
    title: "Projects & Milestones"
    priority: "P0"
    stories:
      - id: "C1"
        title: "Create project from template"
        as: "Project Manager"
        want: "to create a project from a template"
        so: "milestones and due dates are preconfigured"
        priority: "P0"
        acceptance:
          - "PM specifies required fields and milestones are created with offsets"
          - "Manual due date overrides respected"
        tasks:
          - id: "C1-T1"
            title: "Project creation service materializing milestones and requirements"
            status: "done"
            est: "7h"
          - id: "C1-T2"
            title: "POST /projects endpoint with validation"
            status: "done"
            est: "5h"
          - id: "C1-T3"
            title: "New Project modal UI with form validation and success routing"
            status: "todo"
            est: "6h"
          - id: "C1-T4"
            title: "Integration tests for due date offset calculations"
            status: "todo"
            est: "4h"
      - id: "C2"
        title: "Edit milestone"
        as: "Project Manager"
        want: "to update milestone details"
        so: "progress reflects current status"
        priority: "P0"
        acceptance:
          - "PM can change due date, assignment, flags, and mark done"
          - "Overdue status recalculates on schedule"
        tasks:
          - id: "C2-T1"
            title: "PATCH /milestones/{id} endpoint with auditing"
            status: "done"
            est: "6h"
          - id: "C2-T2"
            title: "Drawer and details UI for editing milestone attributes"
            status: "todo"
            est: "6h"
          - id: "C2-T3"
            title: "Background recalculation job for overdue status"
            status: "todo"
            est: "4h"
          - id: "C2-T4"
            title: "Tests covering manual mark done, audit log entries, overdue logic"
            status: "todo"
            est: "4h"
      - id: "C3"
        title: "Timeline events & comments"
        as: "Project team member"
        want: "to post timeline comments"
        so: "team stays informed"
        priority: "P0"
        acceptance:
          - "Posting comment creates timeline event"
          - "Visible in drawer and project details"
        tasks:
          - id: "C3-T1"
            title: "TimelineEvent entity and POST /timeline endpoint"
            status: "done"
            est: "5h"
          - id: "C3-T2"
            title: "UI comment input and timeline feed rendering"
            status: "todo"
            est: "5h"
          - id: "C3-T3"
            title: "Permission tests ensuring contributors limited to assignments"
            status: "todo"
            est: "3h"

  - key: "D"
    title: "Documents & Approvals"
    priority: "P0"
    stories:
      - id: "D1"
        title: "Upload required document"
        as: "Contributor or PM"
        want: "to upload files for milestone requirements"
        so: "reviews can proceed"
        priority: "P0"
        acceptance:
          - "Client requests presigned URL and marks requirement Pending Review"
          - "Versioning increments and progress visible"
        tasks:
          - id: "D1-T1"
            title: "Presigned URL service and S3 client with checksum support"
            status: "done"
            est: "7h"
          - id: "D1-T2"
            title: "Document confirm endpoint storing metadata and firing outbox event"
            status: "done"
            est: "6h"
          - id: "D1-T3"
            title: "uploadMachine integration with drag-and-drop UI"
            status: "todo"
            est: "6h"
          - id: "D1-T4"
            title: "QA large file upload, blocked extensions, error retries"
            status: "todo"
            est: "4h"
      - id: "D2"
        title: "Approve or reject document"
        as: "Project Manager"
        want: "to approve or reject submissions"
        so: "milestones can complete"
        priority: "P0"
        acceptance:
          - "Approval records reviewer, triggers automations"
          - "Rejection captures reason and notifies uploader"
        tasks:
          - id: "D2-T1"
            title: "Approve/Reject endpoints updating document state and outbox"
            status: "done"
            est: "6h"
          - id: "D2-T2"
            title: "Document preview UI with pdf.js and rejection modal"
            status: "todo"
            est: "6h"
          - id: "D2-T3"
            title: "Automation hook tests verifying single execution"
            status: "todo"
            est: "4h"

  - key: "E"
    title: "Overview Grid & Summary Drawer"
    priority: "P0"
    stories:
      - id: "E1"
        title: "Grid portfolio view"
        as: "Project Manager"
        want: "a grid overview of projects and milestones"
        so: "I can monitor progress quickly"
        priority: "P0"
        acceptance:
          - "Grid loads under 2s for 200x15"
          - "Cell colors follow status rules"
          - "Keyboard navigation supported"
        tasks:
          - id: "E1-T1"
            title: "Efficient grid endpoint delivering matrix payload"
            status: "todo"
            est: "7h"
          - id: "E1-T2"
            title: "Virtualized grid UI with tooltips and keyboard support"
            status: "todo"
            est: "8h"
          - id: "E1-T3"
            title: "Performance test fixture seeding 200x15 dataset"
            status: "todo"
            est: "5h"
      - id: "E2"
        title: "Cell context menu"
        as: "Grid user"
        want: "to act from a milestone cell"
        so: "I can quickly perform actions"
        priority: "P0"
        acceptance:
          - "Role-aware actions displayed"
        tasks:
          - id: "E2-T1"
            title: "Context menu UI using floating-ui and keyboard shortcuts"
            status: "todo"
            est: "5h"
          - id: "E2-T2"
            title: "Action wiring to upload, mark done, comment, assign"
            status: "todo"
            est: "6h"
          - id: "E2-T3"
            title: "QA role matrix for menu visibility"
            status: "todo"
            est: "3h"
      - id: "E3"
        title: "Project summary drawer"
        as: "Grid user"
        want: "to open a summary drawer"
        so: "I can inspect milestone details quickly"
        priority: "P0"
        acceptance:
          - "Drawer opens under 300ms with mini timeline"
          - "ESC closes and deep link supported"
        tasks:
          - id: "E3-T1"
            title: "Project summary endpoint providing stats and timeline"
            status: "todo"
            est: "6h"
          - id: "E3-T2"
            title: "Drawer UI with focus trap, deep linking, and outstanding requirements"
            status: "todo"
            est: "7h"
          - id: "E3-T3"
            title: "Integration tests for drawer open/close and data accuracy"
            status: "todo"
            est: "4h"

  - key: "F"
    title: "Project Details"
    priority: "P1"
    stories:
      - id: "F1"
        title: "Project details tabs"
        as: "Project Manager"
        want: "to view project details tabs"
        so: "I can manage deeper data"
        priority: "P1"
        acceptance:
          - "Tabs fetch scoped data"
          - "Navigation preserves state"
        tasks:
          - id: "F1-T1"
            title: "Expand project details endpoint with include filters"
            status: "todo"
            est: "6h"
          - id: "F1-T2"
            title: "Tab UI implementation with hash-based routing"
            status: "todo"
            est: "6h"
          - id: "F1-T3"
            title: "QA tab navigation and state retention"
            status: "todo"
            est: "3h"

  - key: "G"
    title: "Contributor Portal"
    priority: "P0"
    stories:
      - id: "G1"
        title: "Assigned to me list"
        as: "Contributor"
        want: "to see and act on assigned milestones"
        so: "I can complete my tasks"
        priority: "P0"
        acceptance:
          - "Contributor sees only assigned milestones"
          - "Uploads and comments sync with PM view"
        tasks:
          - id: "G1-T1"
            title: "GET /me/assignments endpoint with workspace scoping"
            status: "todo"
            est: "5h"
          - id: "G1-T2"
            title: "Contributor portal UI with upload and comment actions"
            status: "todo"
            est: "6h"
          - id: "G1-T3"
            title: "Security tests for access isolation"
            status: "todo"
            est: "4h"

  - key: "H"
    title: "Automations"
    priority: "P0"
    stories:
      - id: "H1"
        title: "Auto-complete on approvals"
        as: "Project Manager"
        want: "milestones to auto-complete when requirements approved"
        so: "progress reflects document approvals"
        priority: "P0"
        acceptance:
          - "Rule triggers after all requirements approved"
          - "Email stakeholders on completion"
        tasks:
          - id: "H1-T1"
            title: "Outbox-driven worker handling document_approved events"
            status: "todo"
            est: "7h"
          - id: "H1-T2"
            title: "Automation toggle UI in project settings"
            status: "todo"
            est: "5h"
          - id: "H1-T3"
            title: "Tests for idempotent milestone completion and emails"
            status: "todo"
            est: "5h"
      - id: "H2"
        title: "Rule builder"
        as: "Admin"
        want: "to configure automation rules"
        so: "I can react to events"
        priority: "P1"
        acceptance:
          - "CRUD rules with triggers, conditions, actions"
          - "Rule executes once per event"
        tasks:
          - id: "H2-T1"
            title: "Automation CRUD endpoints with JSON schema validation"
            status: "todo"
            est: "7h"
          - id: "H2-T2"
            title: "Rule builder UI wizard"
            status: "todo"
            est: "8h"
          - id: "H2-T3"
            title: "Integration tests verifying rule execution"
            status: "todo"
            est: "5h"
      - id: "H3"
        title: "Due-soon scheduler"
        as: "Project Manager"
        want: "notifications before milestones are due"
        so: "I can mitigate risk"
        priority: "P1"
        acceptance:
          - "Quartz job emits due_soon events"
          - "Email and timeline updates occur"
        tasks:
          - id: "H3-T1"
            title: "Quartz scheduled job scanning milestones and emitting events"
            status: "todo"
            est: "6h"
          - id: "H3-T2"
            title: "Notification handling for due soon events"
            status: "todo"
            est: "5h"
          - id: "H3-T3"
            title: "Time-travel tests validating scheduler"
            status: "todo"
            est: "4h"

  - key: "I"
    title: "Notifications"
    priority: "P1"
    stories:
      - id: "I1"
        title: "Email templates"
        as: "Project Manager"
        want: "email notifications"
        so: "stakeholders stay informed"
        priority: "P1"
        acceptance:
          - "Templates for assignment, upload, approvals, due soon, milestone done"
        tasks:
          - id: "I1-T1"
            title: "Email template rendering engine and SendGrid provider"
            status: "todo"
            est: "6h"
          - id: "I1-T2"
            title: "Template library with sample content"
            status: "todo"
            est: "4h"
          - id: "I1-T3"
            title: "QA email delivery and content"
            status: "todo"
            est: "3h"
      - id: "I2"
        title: "In-app feed"
        as: "User"
        want: "an in-app notifications feed"
        so: "I can track updates"
        priority: "P1"
        acceptance:
          - "Messages page lists notifications and supports mark read"
        tasks:
          - id: "I2-T1"
            title: "Notifications endpoints and persistence"
            status: "todo"
            est: "6h"
          - id: "I2-T2"
            title: "Frontend feed UI with polling"
            status: "todo"
            est: "5h"
          - id: "I2-T3"
            title: "QA unread counts and optimistic updates"
            status: "todo"
            est: "3h"

  - key: "J"
    title: "Calendar"
    priority: "P1"
    stories:
      - id: "J1"
        title: "Milestone calendar view"
        as: "Project Manager"
        want: "a calendar of due dates"
        so: "I can plan work"
        priority: "P1"
        acceptance:
          - "Monthly/weekly view shows due milestones"
          - "Click opens summary drawer"
        tasks:
          - id: "J1-T1"
            title: "Calendar data endpoint with date range filter"
            status: "todo"
            est: "5h"
          - id: "J1-T2"
            title: "Calendar UI with navigation and accessibility"
            status: "todo"
            est: "6h"
          - id: "J1-T3"
            title: "QA timezone handling and drawer integration"
            status: "todo"
            est: "3h"

  - key: "K"
    title: "Analytics"
    priority: "P1"
    stories:
      - id: "K1"
        title: "Analytics v1"
        as: "Executive"
        want: "portfolio analytics"
        so: "I understand performance"
        priority: "P1"
        acceptance:
          - "Counts for project status, milestone completion, approval time"
          - "CSV export available"
        tasks:
          - id: "K1-T1"
            title: "Analytics aggregation queries and caching"
            status: "todo"
            est: "6h"
          - id: "K1-T2"
            title: "Analytics dashboard UI with charts"
            status: "todo"
            est: "6h"
          - id: "K1-T3"
            title: "QA data accuracy against fixtures"
            status: "todo"
            est: "3h"

  - key: "L"
    title: "Admin & Audit"
    priority: "P0"
    stories:
      - id: "L1"
        title: "Users list & invite"
        as: "Admin"
        want: "to manage workspace users"
        so: "I control access"
        priority: "P0"
        acceptance:
          - "Admin can create users, set roles, assign skills, activate/deactivate"
        tasks:
          - id: "L1-T1"
            title: "User management endpoints with invites and role assignment"
            status: "todo"
            est: "6h"
          - id: "L1-T2"
            title: "Admin user management UI"
            status: "todo"
            est: "6h"
          - id: "L1-T3"
            title: "QA covering role changes and activation"
            status: "todo"
            est: "3h"
      - id: "L2"
        title: "Audit log"
        as: "Admin"
        want: "to review audit logs"
        so: "I can trace sensitive actions"
        priority: "P0"
        acceptance:
          - "Audit entries recorded for critical actions"
          - "Filterable audit log UI"
        tasks:
          - id: "L2-T1"
            title: "Audit middleware writing entries for critical events"
            status: "todo"
            est: "6h"
          - id: "L2-T2"
            title: "Audit log endpoint with filters"
            status: "todo"
            est: "5h"
          - id: "L2-T3"
            title: "Audit log UI with filtering"
            status: "todo"
            est: "5h"
          - id: "L2-T4"
            title: "QA audit coverage and retention"
            status: "todo"
            est: "3h"

  - key: "M"
    title: "Performance, Accessibility, Hardening"
    priority: "P1"
    stories:
      - id: "M1"
        title: "Performance and security hardening"
        as: "Engineer"
        want: "to ensure the platform is fast and secure"
        so: "users have a reliable experience"
        priority: "P1"
        acceptance:
          - "Virtualization tuned, indexes in place, ARIA compliance, rate limiting"
        tasks:
          - id: "M1-T1"
            title: "Database indexes, N+1 query audits"
            status: "todo"
            est: "5h"
          - id: "M1-T2"
            title: "Accessibility review and keyboard flows"
            status: "todo"
            est: "4h"
          - id: "M1-T3"
            title: "Implement API rate limiting and CSP"
            status: "todo"
            est: "4h"
          - id: "M1-T4"
            title: "Performance testing with benchmarks and fixes"
            status: "todo"
            est: "5h"

  - key: "O"
    title: "Platform & DevOps Foundations"
    priority: "P0"
    stories:
      - id: "O1"
        title: "Backend foundations"
        as: "Engineer"
        want: "a structured solution with infrastructure"
        so: "development can proceed"
        priority: "P0"
        acceptance:
          - "Solution projects created with DI, logging, swagger"
          - "Workspace filter and migrations configured"
        tasks:
          - id: "O1-T1"
            title: "Create solution/projects, configure DI, options, Serilog, OpenTelemetry"
            status: "done"
            est: "7h"
          - id: "O1-T2"
            title: "EF Core DbContext, migrations, workspace filter, seed data"
            status: "done"
            est: "6h"
          - id: "O1-T3"
            title: "Swagger configuration with auth support"
            status: "done"
            est: "3h"
      - id: "O2"
        title: "DevOps & CI/CD"
        as: "Engineer"
        want: "automation for builds and local dev"
        so: "team can run and deploy easily"
        priority: "P0"
        acceptance:
          - "Docker compose for Postgres, MinIO, API, worker, web"
          - "CI builds .NET and web, runs tests, handles migrations"
        tasks:
          - id: "O2-T1"
            title: "Dockerfiles and docker-compose with migrations on startup"
            status: "todo"
            est: "6h"
          - id: "O2-T2"
            title: "GitHub Actions workflow for API, worker, web builds and tests"
            status: "todo"
            est: "5h"
          - id: "O2-T3"
            title: ".env.example and runbook/README updates"
            status: "todo"
            est: "3h"
